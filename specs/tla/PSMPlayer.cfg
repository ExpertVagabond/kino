\* PSM Player Complete System - TLC Configuration
\* Run with: tlc PSMPlayer.tla -config PSMPlayer.cfg

CONSTANTS
    \* Video properties
    VideoDuration = 6
    SegmentDuration = 4

    \* Quality levels (indices 0-3)
    NumQualityLevels = 4
    QualityBitrates = [q \in 0..3 |->
        CASE q = 0 -> 500
          [] q = 1 -> 1000
          [] q = 2 -> 2500
          [] q = 3 -> 5000
          [] OTHER -> 0]

    \* Buffer configuration (in seconds)
    MaxBuffer = 24
    MinBufferToPlay = 8
    TargetBuffer = 16

    \* Network (in kbps)
    MaxBandwidth = 6000
    MinBandwidth = 400

    \* Concurrency
    MaxDownloadWorkers = 2

SPECIFICATION Spec

\* === Safety Invariants ===
INVARIANTS
    TypeOK
    MutualExclusionDisplayModes
    BufferBounded
    WorkersBounded
    QualityValid
    PositionValid

\* === Liveness Properties ===
PROPERTIES
    EventuallyPlaysOrErrors
    BufferingResolves
    PlaybackCompletes
    DownloadsProgress

\* Don't check for deadlock (player can be in stable Ended state)
CHECK_DEADLOCK FALSE

\* State constraint to limit exploration (for tractability)
CONSTRAINT
    /\ rebufferCount <= 5
    /\ qualitySwitchCount <= 10
    /\ downloadedBytes <= 1000000
